<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Temp Chat</title>

<script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>

<style>
body{
  font-family:monospace;
  background:#000;
  color:#00ff57;
}
.container{
  max-width:500px;
  margin:20px auto;
  border:2px solid #00ff57;
  padding:12px;
}
h1{text-align:center}
.top-status{
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.spinner{
  animation:spin 1s linear infinite;
}
@keyframes spin{100%{transform:rotate(360deg)}}
.chat{
  height:280px;
  overflow-y:auto;
  border:1px solid #00ff57;
  padding:8px;
  margin-top:10px;
}
.bubble{
  max-width:70%;
  padding:6px;
  margin:6px 0;
  border-radius:8px;
}
.self{
  background:#003300;
  margin-left:auto;
  text-align:right;
}
.other{
  background:#111;
}
.controls{
  display:flex;
  gap:5px;
  margin-top:8px;
}
input,button{
  background:#000;
  color:#00ff57;
  border:1px solid #00ff57;
  padding:6px;
}
</style>
</head>

<body>
<div class="container">

<h1>Temp Chat</h1>

<div class="top-status">
  <div id="serverStatus">
    <span class="spinner">ðŸ”„</span> Connectingâ€¦
  </div>
  <div id="timer">00:00</div>
</div>

<hr>

<div>
  Your Code: <b id="yourId"></b>
</div>

<div class="controls">
  <input id="connectToId" placeholder="Enter 4-digit code">
  <button id="connectBtn">Connect</button>
  <button id="disconnectBtn" style="display:none">Disconnect</button>
</div>

<div class="chat" id="messageCanvas"></div>

<div class="controls">
  <span onclick="fileInput.click()">ðŸ“Ž</span>
  <input id="chatInput" placeholder="Type message">
  <button id="sendBtn">Send</button>
</div>

<input type="file" id="fileInput" hidden>

</div>

<script>
const socket = io("https://device-connector-backend.onrender.com");

const yourId = Math.floor(1000 + Math.random() * 9000).toString();
document.getElementById("yourId").textContent = yourId;

let seconds = 0;
let timerInt = null;

socket.on("connect", () => {
  document.getElementById("serverStatus").innerHTML = "âœ… Server Connected";
  socket.emit("register-device", { code: yourId });
});

// timer
function startTimer(){
  timerInt = setInterval(() => {
    seconds++;
    const m = String(Math.floor(seconds/60)).padStart(2,"0");
    const s = String(seconds%60).padStart(2,"0");
    document.getElementById("timer").textContent = m+":"+s;
  },1000);
}

document.getElementById("connectBtn").onclick = () => {
  const target = document.getElementById("connectToId").value;
  socket.emit("connect-to-code", { fromCode: yourId, targetCode: target });
};

document.getElementById("disconnectBtn").onclick = () => {
  location.reload();
};

document.getElementById("sendBtn").onclick = () => {
  const msg = chatInput.value;
  if (!msg) return;
  socket.emit("send-message", { text: msg });
  addBubble(msg,"self");
  chatInput.value="";
};

fileInput.onchange = (e) => {
  const f = e.target.files[0];
  if (!f) return;
  const r = new FileReader();
  r.onload = () => {
    socket.emit("send-file", { name:f.name, data:r.result });
    addBubble("ðŸ“Ž "+f.name,"self");
  };
  r.readAsDataURL(f);
};

socket.on("receive-message", d => addBubble(d.text,"other"));
socket.on("receive-file", d => addBubble("ðŸ“Ž "+d.name,"other"));

socket.on("connection-success", () => {
  startTimer();
  document.getElementById("disconnectBtn").style.display="inline-block";
});

function addBubble(text,type){
  const div=document.createElement("div");
  div.className="bubble "+type;
  div.textContent=text;
  messageCanvas.appendChild(div);
  messageCanvas.scrollTop=messageCanvas.scrollHeight;
}
</script>
</body>
</html>
